<?xml version='1.0' encoding='UTF-8'?>
<MorpheusModel version="4">
    <Description>
        <Title>Example-Dictyostelium</Title>
        <Details>Aggregation of dictyostelium by chemotactic amoeba as excitable medium mediated by diffusive cAMP signal.

Original reference:
- Nicholas Savill and Paulien Hogeweg, Modelling morphogenesis: from single cells to crawling slugs, J. Theo. Biol., 1997.

Morpeus implementation by ECMI 2012 summer course:
- A. Quintero, M. Myllykoski, A. Igolkina, A. Freltoft, N. Dixit, F. Rost, Morphogenesis and Dynamics of Multicellular Systems, ECMI Newletter 52, 2012.</Details>
    </Description>
    <Global>
        <Field value="0" name="cAMP" symbol="c">
            <Diffusion rate="1"/>
            <BoundaryValue value="0" boundary="x"/>
            <BoundaryValue value="0" boundary="-x"/>
            <BoundaryValue value="0" boundary="y"/>
            <BoundaryValue value="0" boundary="-y"/>
        </Field>
        <Field value="0" name="refractoriness" symbol="r">
            <Diffusion rate="0"/>
            <BoundaryValue value="0" boundary="x"/>
            <BoundaryValue value="0" boundary="-x"/>
            <BoundaryValue value="0" boundary="y"/>
            <BoundaryValue value="0" boundary="-y"/>
        </Field>
        <System time-step="0.1" solver="Heun [fixed, O(2)]">
            <Constant value="0.006" symbol="c1"/>
            <Constant value="0.841" symbol="c2"/>
            <DiffEqn symbol-ref="c">
                <Expression>is_amoeba*(-f() -r)</Expression>
            </DiffEqn>
            <DiffEqn symbol-ref="r">
                <Expression>is_amoeba*epsilon()*(3.5*c-b-r)</Expression>
            </DiffEqn>
            <Function symbol="epsilon">
                <Expression>if(c &lt; c1, 0.5,
 if(c &lt; c2, 0.0589,
  0.5))</Expression>
            </Function>
            <Function symbol="f">
                <Expression>if(c &lt; c1, 20*c, 
 if(c &lt; c2, -3*c+0.15,
  15*(c-1)))</Expression>
                <!--    <Disabled>
        <Expression>-3*c</Expression>
    </Disabled>
-->
            </Function>
        </System>
    </Global>
    <Space>
        <Lattice class="square">
            <Size value="150, 150, 0" symbol="l"/>
            <BoundaryConditions>
                <Condition type="constant" boundary="x"/>
                <Condition type="constant" boundary="-x"/>
                <Condition type="constant" boundary="y"/>
                <Condition type="constant" boundary="-y"/>
            </BoundaryConditions>
            <NodeLength value="0.37"/>
            <Neighborhood>
                <Distance>1.5</Distance>
            </Neighborhood>
        </Lattice>
        <SpaceSymbol symbol="space"/>
    </Space>
    <Time>
        <StartTime value="0"/>
        <StopTime value="750" symbol="end"/>
        <TimeSymbol symbol="time"/>
        <RandomSeed value="1357906713"/>
    </Time>
    <CellTypes>
        <CellType name="medium" class="medium">
            <Property value="0" symbol="b"/>
            <Property value="0" symbol="max_c"/>
            <Property value="0" symbol="phase"/>
            <Property value="0" symbol="is_amoeba"/>
        </CellType>
        <CellType name="amoeba" class="biological">
            <VolumeConstraint target="40" strength="1"/>
            <Chemotaxis field="c" strength="if(phase == 2, 10, 0)"/>
            <Property value="1.0" symbol="is_amoeba"/>
            <Property value="0" symbol="b"/>
            <Property value="0" symbol="max_c"/>
            <Property value="1" symbol="phase"/>
            <Property value="0" symbol="phaseTime"/>
            <Property value="0.1" symbol="phase2duration"/>
            <Function symbol="mu">
                <Expression>if(phase == 2, 10, 0)</Expression>
            </Function>
            <System time-step="1.0" solver="Euler [fixed, O(1)]">
                <Rule symbol-ref="phaseTime">
                    <Expression>if(phase == 2, phaseTime+MCStime, 0)</Expression>
                </Rule>
                <Rule symbol-ref="phase" name="Rule_2_3">
                    <Expression>if(phase == 1 and max_c > 0.1, 2,
if(phase == 2 and phaseTime>phase2duration, 3,
if(phase == 3 and max_c &lt; 0.05, 1, 
phase
))) </Expression>
                </Rule>
            </System>
            <Mapper>
                <Input value="c"/>
                <Output symbol-ref="max_c" mapping="maximum"/>
            </Mapper>
        </CellType>
        <CellType name="autoAmoeba" class="biological">
            <VolumeConstraint target="40" strength="1"/>
            <Property value="0.5" symbol="b"/>
            <Property value="0" symbol="max_c"/>
            <Property value="0" symbol="phase"/>
            <Property value="1.0" symbol="is_amoeba"/>
        </CellType>
    </CellTypes>
    <CPM>
        <Interaction>
            <Contact value="4" type1="amoeba" type2="amoeba"/>
            <Contact value="2" type1="amoeba" type2="medium"/>
            <Contact value="4" type1="amoeba" type2="autoAmoeba"/>
            <Contact value="3" type1="autoAmoeba" type2="medium"/>
        </Interaction>
        <MonteCarloSampler stepper="edgelist">
            <MCSDuration value="0.5" symbol="MCStime"/>
            <Neighborhood>
                <Order>2</Order>
            </Neighborhood>
            <MetropolisKinetics temperature="1.0" yield="0.1"/>
        </MonteCarloSampler>
        <ShapeSurface scaling="norm">
            <Neighborhood>
                <Distance>1.5</Distance>
            </Neighborhood>
        </ShapeSurface>
    </CPM>
    <CellPopulations>
        <Population size="1" type="autoAmoeba">
            <InitRectangle mode="regular" number-of-cells="1">
                <Dimensions origin="l.x/2, l.y/2, 0" size="10, 10, 0"/>
            </InitRectangle>
        </Population>
        <Population size="1" type="amoeba">
            <InitRectangle mode="regular" number-of-cells="250">
                <Dimensions origin="3,3,0" size="l.x-6,l.y-6,1"/>
            </InitRectangle>
        </Population>
    </CellPopulations>
    <Analysis>
        <Gnuplotter time-step="5" decorate="false">
            <Terminal name="png" size="400 400 0"/>
            <Plot>
                <Field max="1.0" symbol-ref="c" min="0">
                    <ColorMap>
                        <Color value="0" color="white"/>
                        <Color value="0.5" color="yellow"/>
                        <Color value="1.0" color="red"/>
                    </ColorMap>
                </Field>
                <Cells value="phase" max="3" opacity="0.65" min="0">
                    <ColorMap>
                        <Color value="0" color="black"/>
                        <Color value="1" color="yellow"/>
                        <Color value="2" color="green"/>
                        <Color value="3" color="red"/>
                    </ColorMap>
                </Cells>
            </Plot>
        </Gnuplotter>
        <DependencyGraph include-tags="#untagged" reduced="false" format="svg"/>
    </Analysis>
</MorpheusModel>
